<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Funny Sanke Game!</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #0b0b0b;
    }

    .game-info {
      padding: 40px 0 0;
      background-color: #000;
      color: #fff;
      text-align: center;
    }

    #score {
      font-size: 40px;
      font-weight: 500;
    }

    #screen {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      width: 100%;
    }

    .btn {
      flex: 1 1 auto;
      margin: 10px;
      padding: 20px 50px;
      text-align: center;
      transition: 0.5s;
      background-size: 200% auto;
      color: rgb(255, 255, 255);
      background-image: linear-gradient(to right, #654ea3 0%, #eaafc8 51%, #654ea3 100%);
      box-shadow: 0 0 20px #eee;
      border-radius: 10px;
      font-size: 20px;
      font-weight: 600;
    }

    .btn:hover {
      background-position: right center;
    }

    #sub-option {
      padding: 25px;
      color: #fff;
      font-size: 30px;
    }

    #snake-map {
      position: absolute;
      top: 28%;
      left: 50%;
      transform: translateX(-50%);
      height: 850px;
      width: 850px;
      background-image: url("img/bg-snake.jpeg");
      background-size: cover;
      z-index: 100;
    }

    .snake {
      position: absolute;
      top: 0;
      left: 0;
      width: 50px;
      height: 50px;
      z-index: 300;
      background: url(img/img-alian.png) no-repeat center center/100%;
    }

    .food {
      position: absolute;
      top: 0;
      left: 0;
      background-color: gold;
      height: 50px;
      width: 50px;
      border-radius: 50%;
      z-index: 200;
      background: url(img/img-virus.png) no-repeat center center/100%;
    }
  </style>
</head>

<body>

  <body>
    <div id="screen">
      <div id="snake-map"></div>
    </div>
    <div id="game-wrap">
      <div id="score-board" class="game-info">
        <p id="score">ğŸ›¸ ì¬ë¯¸ìˆëŠ” ìš°ì£¼ê²Œì„ ğŸ‘½</p>
      </div>
      <div id="game-start" class="game-info">
        <button class="btn" id="do-play" onclick="gamePlay()">ê²Œì„ ì‹œì‘!</button>
        <div id="sub-option">

        </div>
      </div>
    </div>

    </div>
  </body>
  <script>
    // ë§µ ìƒì„±
    var mapHeight = 17; // = 850 / 50
    var mapWidth = 17; // = 850 / 50
    var blockSize = 50;
    // ë±€ ë°©í–¥ 
    var directions = {
      up: 0,
      right: 1,
      down: 2,
      left: 3
    }
    // ë±€ ì´ë™
    var colMove = [0, 1, 0, -1];
    var rowMove = [-1, 0, 1, 0];

    var sankeDirection = directions["down"];
    var snakeDead = false;
    var snakeEating = false;
    var playGame = false;
    var gameOver = false;
    var gameLoop;
    var speed = 140;
    var gameScore = 0;

    var gameMap = document.getElementById("snake-map");
    var scoreText = document.getElementById("score");
    var playButton = document.getElementById("do-play");
    var messageBox = document.getElementById("sub-option");

    // Handle user input
    document.onkeydown = moveSnake;

    function moveSnake(e) {
      e = e || window.event;

      if (e.keyCode == '38') {
        // up arrow
        sankeDirection = directions["up"];
      } else if (e.keyCode == '40') {
        // down arrow
        sankeDirection = directions["down"];
      } else if (e.keyCode == '37') {
        // left arrow
        sankeDirection = directions["left"];
      } else if (e.keyCode == '39') {
        // right arrow
        sankeDirection = directions["right"];
      }
    }

    var snake = [];

    var snakeHead = new SnakePiece(2, 3);

    var foods = [];
    foods.push(new FoodPiece());

    // ë±€ì— ë¨¸ë¦¬ ì¶”ê°€ 
    snake.push(snakeHead);

    // ê²Œì„ ì‹¤í–‰í•˜ë©´ ë°˜ë³µë˜ëŠ” í•¨ìˆ˜ë“¤
    function play() {
      gameLoop = setInterval(function () {

        // ë±€ ìë™ ì´ë™
        snake.unshift(new SnakePiece(snake[0].row + rowMove[sankeDirection], snake[0].col + colMove[
          sankeDirection]));

        // ì‚¬ê³¼ë¥¼ ë¨¹ì—ˆì„ ë•Œ 
        snakeEating = isEating();
        if (snakeEating) {
          gameScore = gameScore + 10;
        }
        // ì‚¬ê³¼ ë¨¹ì§€ ì•Šì•˜ì„ë•ŒëŠ” ê¼¬ë¦¬ë¥¼ í•˜ë‚˜ì”© ì§€ì›€
        if (!snakeEating) {
          gameMap.removeChild(snake.pop().el);
        }
        // ë±€ì´ ì£½ì—ˆì„ ë•Œ 
        snakeDead = isDying();
        if (snakeDead) {
          playGame = false;
          handleDeath();
        }

        snakeEating = false;
        snakeDead = false;

        scoreText.innerText = "í˜„ì¬ ì ìˆ˜: " + gameScore;
        if (!gameOver) {
          playButton.innerText = playGame ? "ë©ˆì¶°!" : "ê²Œì„ ì‹œì‘!";
        }

        // ì‚¬ê³¼ ë‹¤ë¨¹ìœ¼ë©´ ë‹¤ì‹œ ìƒì„±
        if (foods.length < 1) {
          foods.push(new FoodPiece());
        }
      }, speed);
    }

    // ê²Œì„ ì‹¤í–‰
    function gamePlay() {
      playGame = !playGame;
      if (playGame) {
        play();
      } else {
        clearInterval(gameLoop);
      }
    }

    // ë±€ì´ ì£½ì—ˆì„ ë•Œ ì‹¤í–‰
    function handleDeath() {

      // ê²Œì„ ë©ˆì¶”ê¸° 
      clearInterval(gameLoop);

      // ì£½ì€ ë©”ì„¸ì§€ 
      gameOver = true;
      messageBox.innerText = "ğŸ”¥ ê²Œì„ì˜¤ë²„ ğŸ”¥";

      // ë±€ ì§€ìš°ê¸°
      while (snake[0]) {
        gameMap.removeChild(snake.pop().el);
      }

      // ìŠ¤ë„¤ì´í¬ ë¦¬ìŠ¤í°
      setTimeout(function () {
        playButton.innerText = "ê²Œì„ ì‹œì‘!";

        // ê²Œì„ ì´ˆê¸°í™”
        snakeHead = new SnakePiece(1, 1);
        snake.push(snakeHead);
        gameOver = false;
      }, 1500);
    }

    /// ìŠ¤ë„¤ì´í¬ ëª¸ ê°ì²´ ìƒì„± 
    function SnakePiece(row, col) {
      /* ìŠ¤ë„¤ì´í¬ ìƒì„± */
      var snakeBody = document.createElement("div");
      snakeBody.className = "snake";
      snakeBody.style.top = (row * blockSize) + "px";
      snakeBody.style.left = (col * blockSize) + "px";
      gameMap.appendChild(snakeBody);
      this.col = col;
      this.row = row;
      this.el = snakeBody;
    }

    // ì‚¬ê³¼ ê°ì²´ ìƒì„±
    function FoodPiece() {
      var col = getRandomNum(0, mapWidth);
      var row = getRandomNum(0, mapHeight);

      var apple = document.createElement("div");
      apple.className = "food";
      apple.style.top = (row * blockSize) + "px";
      apple.style.left = (col * blockSize) + "px";
      gameMap.appendChild(apple);

      this.col = col;
      this.row = row;
      this.el = apple;
    }

    // ì£½ì—ˆëŠ”ì§€ í™•ì¸
    function isDying() {
      // ë²½ì— ë¶€ë”ªí˜”ì„ ë•Œ
      var head = snake[0];
      if (head.row < 0 || head.row >= mapHeight || head.col < 0 || head.col >= mapWidth) {
        return true;
      }
      // ìê¸° ëª¸ì— ë¶€ë”ªí˜”ì„ ë•Œ
      var i;
      for (i = 1; i < snake.length; i++) {
        var curPiece = snake[i];
        if (head.row === curPiece.row && head.col === curPiece.col) { // ë¨¸ë¦¬ì˜ ìœ„ì¹˜ì™€ ëª¸ì˜ ìœ„ì¹˜ê°€ ë§Œë‚  ë•Œ
          return true;
        }
      }
      return false;
    }
    // ì‚¬ê³¼ ë¨¹ê¸°
    function isEating() {
      var head = snake[0];
      var i;
      for (i = 0; i < foods.length; i++) {
        var curPiece = foods[i];
        if (head.row === curPiece.row && head.col === curPiece.col) { // ì‚¬ê³¼ì˜ ìœ„ì¹˜ì™€ ëª¸ì˜ ìœ„ì¹˜ê°€ ë§Œë‚  ë•Œ

          foods.splice(i, 1); //ë°°ì—´ ë³€ê²½ì„ ì‹œì‘í•  ì¸ë±ìŠ¤ i, ë°°ì—´ì—ì„œ ì œê±°í•  ìš”ì†Œì˜ ìˆ˜ 1 - ì‚¬ê³¼ì˜ ë°°ì—´ì—ì„œ ì œê±°
          gameMap.removeChild(curPiece.el); // appleì„ ì œê±°
          return true;


        }
      }
      return false;
    }

    /* ë‚œìˆ˜ ìƒì„± */
    function getRandomNum(min, max) {
      return Math.floor(Math.random() * (max - min));
    }
  </script>
</body>

</html>