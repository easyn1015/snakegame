<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, maximum-scale=1.0, minimum-scale=1, user-scalable=yes,initial-scale=1.0" />
    <title>Funny Sanke Game!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #201d22;
        }

        .game-info {
            padding: 20px 0 0;
            background-color: #000;
            color: #fff;
            text-align: center;
        }

        #score {
            padding: 0 0 20px;
            font-size: 30px;
            font-weight: 500;
        }

        #screen {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0 0;
            height: 100%;
            width: 100%;
        }

        .btn {
            flex: 1 1 auto;
            margin: 10px;
            padding: 15px 45px;
            text-align: center;
            transition: 0.5s;
            background-size: 200% auto;
            color: rgb(255, 255, 255);
            background-image: linear-gradient(to right, #654ea3 0%, #eaafc8 51%, #654ea3 100%);
            box-shadow: 0 0 20px #eee;
            border-radius: 10px;
            font-size: 20px;
            font-weight: 600;
        }

        .btn:hover {
            background-position: right center;
        }

        #sub-option {
            display: none;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
            width: 100%;
            height: 100%;
            vertical-align: middle;
            background: rgba(0, 0, 0, 0.8);

        }

        #sub-option p {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 300;
            font-size: 50px;
        }

        #sub-option.on {
            display: flex;
        }

        #snake-map {
            position: relative;
            height: 850px;
            width: 850px;
            background-image: url("img/bg-snake.jpeg");
            background-size: cover;

        }

        .snake {
            position: absolute;
            top: 0;
            left: 0;
            width: 50px;
            height: 50px;
            z-index: 300;
            background: url(img/img-monster.png) no-repeat center center/100%;
        }

        .food {
            position: absolute;
            top: 0;
            left: 0;
            background-color: gold;
            height: 50px;
            width: 50px;
            border-radius: 50%;
            z-index: 200;
            background: url(img/img-star.png) no-repeat center center/100%;
        }

        .mobile-direction-key {
            display: block;
            margin: 0 auto;
            padding: 20px 0;
            width: 50vw;
            height: auto;
            text-align: center;
        }

        .mobile-direction-key a {
            display: inline-block;
            width: 40px;
            height: 40px;
            background-repeat: no-repeat;
            background-position: center center;
            background-size: 100%;
            text-indent: -99999px;
        }

        #btn-up {
            display: block;
            margin: 0 auto;
            background-image: url(img/up-arrow-y.png);
        }

        #btn-down {
            display: block;
            margin: 0 auto;
            background-image: url(img/down-arrow-y.png);
        }

        #btn-left {
            margin: 0 10% 0 0;
            background-image: url(img/left-arrow-y.png);
        }

        #btn-right {
            margin: 0 0 0 10%;
            background-image: url(img/right-arrow-y.png);
        }

        #btn-change-charactor {
            display: block;
        }

        @media screen and (max-width: 1024px) {

            #score-board {
                padding: 20px 0 0;
            }

            #score {
                padding: 0 0 10px;
            }

            .game-info {
                padding: 0 0 20px;
            }

            #score {
                font-size: 20px;
            }

            .btn {
                margin: 0;
                padding: 10px 30px;
                font-size: 15px
            }

            #snake-map {
                height: 480px;
                width: 480px;
            }

            #sub-option p {
                font-size: 30px;
            }

            .snake {
                width: 20px;
                height: 20px;
            }

            .food {
                height: 20px;
                width: 20px;
            }

            @media screen and (max-width: 480px) {
                #snake-map {
                    height: 320px;
                    width: 320px;
                }
            }

        }
    </style>
</head>

<body>

    <body>

        <div id="game-wrap">
            <div id="score-board" class="game-info">
                <p id="score">üõ∏ Ïû¨ÎØ∏ÏûàÎäî Ïö∞Ï£º Ïä§ÎÑ§Ïù¥ÌÅ¨ Í≤åÏûÑ üëΩ</p>
                <div id="sub-option">
                    <p> üíÄ Í≤åÏûÑÏò§Î≤Ñ üíÄ</p>
                </div>
            </div>
            <div id="game-start" class="game-info">
                <button class="btn" id="do-play" onclick="gamePlay()">Í≤åÏûÑ ÏãúÏûë!</button>
                <!-- <a class="btn" href="giraff-game.html" target="_blank" title="Í∏∞Î¶∞ Í≤åÏûÑ(Ïù¥Ï†ÑÎ≤ÑÏ†Ñ)" >Í∏∞Î¶∞Í≤åÏûÑ(Ïù¥Ï†ÑÎ≤ÑÏ†Ñ)</a>-->
            </div>
            <div id="screen">
                <div id="snake-map"></div>
            </div>
            <div class="mobile-direction-key">
                <a href="#a" id="btn-up">Up</a>
                <a href="#a" id="btn-left">Left</a>
                <a href="#a" id="btn-right">Right</a>
                <a href="#a" id="btn-down">down</a>
            </div>
        </div>

        </div>

    </body>
    <script>
        // Îßµ ÏÉùÏÑ±
        var mapHeight = 17;
        var mapWidth = 17; // = 850 / 50
        var blockSize = 50;

        // Î±Ä Î∞©Ìñ• 
        var directions = {
            up: 0,
            right: 1,
            down: 2,
            left: 3
        }
        // Î±Ä Ïù¥Îèô
        var colMove = [0, 1, 0, -1];
        var rowMove = [-1, 0, 1, 0];

        var sankeDirection = directions["down"];
        var snakeDead = false;
        var snakeEating = false;
        var playGame = false;
        var gameOver = false;
        var gameLoop;
        var speed = 140;
        var gameScore = 0;

        var gameMap = document.getElementById("snake-map");
        var scoreText = document.getElementById("score");
        var playButton = document.getElementById("do-play");
        var messageBox = document.getElementById("sub-option");
        var btnUp = document.getElementById("btn-up");
        var btnDown = document.getElementById("btn-down");
        var btnLeft = document.getElementById("btn-left");
        var btnRight = document.getElementById("btn-right");

        if (window.innerWidth <= 1024) {
            var blockSize = 20;
            var mapHeight = 24;
            var mapWidth = 24; // = 480 / 20
        }
        if (window.innerWidth <= 480) {
            var blockSize = 20;
            var mapHeight = 16;
            var mapWidth = 16; // = 320 / 20
        }
        window.addEventListener('resize', function (event) {
            if (window.innerWidth <= 1024) {
                var blockSize = 20;
                var mapHeight = 24;
                var mapWidth = 24; // = 480 / 20
            }
            if (window.innerWidth <= 480) {
                var blockSize = 20;
                var mapHeight = 16;
                var mapWidth = 16; // = 320 / 20
            }
        }, true);
        // Î±Ä Ï°∞Ï¢Ö
        document.onkeydown = moveSnake;
        moveSnakeMobile();

        function moveSnake(e) {
            e = e || window.event;

            if (e.keyCode == '38') {
                // up arrow
                sankeDirection = directions["up"];
            } else if (e.keyCode == '40') {
                // down arrow
                sankeDirection = directions["down"];
            } else if (e.keyCode == '37') {
                // left arrow
                sankeDirection = directions["left"];
            } else if (e.keyCode == '39') {
                // right arrow
                sankeDirection = directions["right"];
            }

        }

        function moveSnakeMobile(event) {
            btnUp.addEventListener('click', function (event) {
                // up arrow
                sankeDirection = directions["up"];
                console.log('up')
            });
            btnDown.addEventListener('click', function (event) {
                // down arrow
                sankeDirection = directions["down"];
            });
            btnLeft.addEventListener('click', function (event) {
                // left arrow
                sankeDirection = directions["left"];
            });
            btnRight.addEventListener('click', function (event) {
                // right arrow
                sankeDirection = directions["right"];
            });
        }
        var snake = [];
        var snakeHead = new SnakePiece(2, 3);

        var foods = [];
        foods.push(new FoodPiece());

        // Î±ÄÏóê Î®∏Î¶¨ Ï∂îÍ∞Ä 
        snake.push(snakeHead);

        // Í≤åÏûÑ Ïã§ÌñâÌïòÎ©¥ Î∞òÎ≥µÎêòÎäî Ìï®ÏàòÎì§
        function play() {
            gameLoop = setInterval(function () {

                // Î±Ä ÏûêÎèô Ïù¥Îèô
                snake.unshift(new SnakePiece(snake[0].row + rowMove[sankeDirection], snake[0].col + colMove[
                    sankeDirection]));

                // ÏÇ¨Í≥ºÎ•º Î®πÏóàÏùÑ Îïå Íº¨Î¶¨ ÏïàÏßÄÏõÄ
                snakeEating = isEating();
                if (snakeEating) {
                    gameScore = gameScore + 10;
                }
                // ÏÇ¨Í≥º Î®πÏßÄ ÏïäÏïòÏùÑÎïåÎäî Íº¨Î¶¨Î•º ÌïòÎÇòÏî© ÏßÄÏõÄ
                if (!snakeEating) {
                    gameMap.removeChild(snake.pop().el);
                }
                // Î±ÄÏù¥ Ï£ΩÏóàÏùÑ Îïå 
                snakeDead = isDying();
                if (snakeDead) {
                    playGame = false;
                    handleDeath();
                }

                snakeEating = false;
                snakeDead = false;

                scoreText.innerText = "üî• ÌòÑÏû¨ Ï†êÏàò üî•: " + gameScore;

                if (!gameOver) {
                    playButton.innerText = playGame ? "Î©àÏ∂∞!" : "Í≤åÏûÑ ÏãúÏûë!";
                }

                // ÏÇ¨Í≥º Îã§Î®πÏúºÎ©¥ Îã§Ïãú ÏÉùÏÑ±
                if (foods.length < 1) {
                    foods.push(new FoodPiece());
                }
            }, speed);
        }

        // Í≤åÏûÑ Ïã§Ìñâ
        function gamePlay() {
            playGame = !playGame;
            if (playGame) {
                play();
            } else {
                clearInterval(gameLoop);
            }
        }

        // Î±ÄÏù¥ Ï£ΩÏóàÏùÑ Îïå Ïã§Ìñâ
        function handleDeath() {

            // Í≤åÏûÑ Î©àÏ∂îÍ∏∞ 
            clearInterval(gameLoop);

            // Ï£ΩÏùÄ Î©îÏÑ∏ÏßÄ 
            gameOver = true;
            messageBox.classList.add('on')

            // Î±Ä ÏßÄÏö∞Í∏∞
            while (snake[0]) {
                gameMap.removeChild(snake.pop().el);
            }

            // Ïä§ÎÑ§Ïù¥ÌÅ¨ Î¶¨Ïä§Ìè∞
            setTimeout(function () {
                scoreText.innerText = "üõ∏ Ïû¨ÎØ∏ÏûàÎäî Ïö∞Ï£ºÍ≤åÏûÑ üëΩ ";
                playButton.innerText = "Í≤åÏûÑ ÏãúÏûë!";
                messageBox.classList.remove('on');
                gameScore = 0

                // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî
                snakeHead = new SnakePiece(1, 1);
                snake.push(snakeHead);
                gameOver = false;

            }, 1500);
        }

        /// Ïä§ÎÑ§Ïù¥ÌÅ¨ Î™∏ Í∞ùÏ≤¥ ÏÉùÏÑ± 
        function SnakePiece(row, col) {
            /* Ïä§ÎÑ§Ïù¥ÌÅ¨ ÏÉùÏÑ± */
            var snakeBody = document.createElement("div");
            snakeBody.className = "snake";
            snakeBody.style.top = (row * blockSize) + "px";
            snakeBody.style.left = (col * blockSize) + "px";

            gameMap.appendChild(snakeBody);

            this.col = col;
            this.row = row;
            this.el = snakeBody;
        }

        // ÏÇ¨Í≥º Í∞ùÏ≤¥ ÏÉùÏÑ±
        function FoodPiece() {
            var col = getRandomNum(0, mapWidth);
            var row = getRandomNum(0, mapHeight);

            var apple = document.createElement("div");
            apple.className = "food";
            apple.style.top = (row * blockSize) + "px";
            apple.style.left = (col * blockSize) + "px";
            gameMap.appendChild(apple);

            this.col = col;
            this.row = row;
            this.el = apple;
        }

        // Ï£ΩÏóàÎäîÏßÄ ÌôïÏù∏
        function isDying() {
            // Î≤ΩÏóê Î∂ÄÎî™ÌòîÏùÑ Îïå
            var head = snake[0];
            if (head.row < 0 || head.row >= mapHeight || head.col < 0 || head.col >= mapWidth) {
                return true;
            }
            // ÏûêÍ∏∞ Î™∏Ïóê Î∂ÄÎî™ÌòîÏùÑ Îïå
            var i;
            for (i = 1; i < snake.length; i++) {
                var curPiece = snake[i];
                if (head.row === curPiece.row && head.col === curPiece.col) { // Î®∏Î¶¨Ïùò ÏúÑÏπòÏôÄ Î™∏Ïùò ÏúÑÏπòÍ∞Ä ÎßåÎÇ† Îïå
                    return true;
                }
            }
            return false;
        }
        // ÏÇ¨Í≥º Î®πÍ∏∞
        function isEating() {
            var head = snake[0];
            var i;
            for (i = 0; i < foods.length; i++) {
                var curPiece = foods[i];
                if (head.row === curPiece.row && head.col === curPiece.col) { // ÏÇ¨Í≥ºÏùò ÏúÑÏπòÏôÄ Î™∏Ïùò ÏúÑÏπòÍ∞Ä ÎßåÎÇ† Îïå

                    foods.splice(i, 1); //Î∞∞Ïó¥ Î≥ÄÍ≤ΩÏùÑ ÏãúÏûëÌï† Ïù∏Îç±Ïä§ i, Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞Ìï† ÏöîÏÜåÏùò Ïàò 1 - ÏÇ¨Í≥ºÏùò Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞
                    gameMap.removeChild(curPiece.el); // appleÏùÑ Ï†úÍ±∞
                    return true;


                }
            }
            return false;
        }

        /* ÎÇúÏàò ÏÉùÏÑ± */
        function getRandomNum(min, max) {
            return Math.floor(Math.random() * (max - min));
        }
    </script>
</body>

</html>